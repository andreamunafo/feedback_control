<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>feedback_control - Block Diagrams</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="feedback_control - Block Diagrams">
<meta property="og:description" content="This notebook will talk about: - Basic components of block diagrams - How to compose block diagrams together - Block diagrams and system properties (e.g., Stability, etc)">
<meta property="og:site-name" content="feedback_control">
<meta name="twitter:title" content="feedback_control - Block Diagrams">
<meta name="twitter:description" content="This notebook will talk about: - Basic components of block diagrams - How to compose block diagrams together - Block diagrams and system properties (e.g., Stability, etc)">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">feedback_control</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Block Diagrams</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Feedback Control</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus.html" class="sidebar-item-text sidebar-link">Syllabus - Principles of Automatic Control / Fondamenti di Automatica 2023</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started_with_python_and_jupyter_notebook.html" class="sidebar-item-text sidebar-link">Getting Started with Python and Jupyter Notebooks</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_to_control_theory.html" class="sidebar-item-text sidebar-link">Introduction to Control Theory: The Control Problem</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transfer_functions.html" class="sidebar-item-text sidebar-link">Transfer Functions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./block_diagrams.html" class="sidebar-item-text sidebar-link active">Block Diagrams</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./system_response.html" class="sidebar-item-text sidebar-link">System Response</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_to_freq_response_and_bode_plots.html" class="sidebar-item-text sidebar-link">Introduction to Frequency Response Methods: Bode Plots</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./final_value_theorem_and_steady_state_error.html" class="sidebar-item-text sidebar-link">Final Value Theorem and Steady State Error</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./main_types_of_loops_and_transfer_functions.html" class="sidebar-item-text sidebar-link">Main types of loops and transfer functions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./routh_hurwitz_criterion.html" class="sidebar-item-text sidebar-link">Routh-Hurwitz Criterion</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part_1_recap.html" class="sidebar-item-text sidebar-link">Part 1 Recap</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nyquist_stability_criterion.html" class="sidebar-item-text sidebar-link">Nyquist Stability Criterion</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stability_margins.html" class="sidebar-item-text sidebar-link">Stability Margins</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loop-shaping.html" class="sidebar-item-text sidebar-link">Controller design: Loop analysis and shaping</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./root_locus.html" class="sidebar-item-text sidebar-link">Root Locus</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lead_lag_compensators.html" class="sidebar-item-text sidebar-link">Phase Lead/Phase Lag Compensators</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pid_control.html" class="sidebar-item-text sidebar-link">PID Control</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part_2_recap.html" class="sidebar-item-text sidebar-link">Part 2 Recap</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./murray_hopper.html" class="sidebar-item-text sidebar-link">Grace Murray Hopper (1906-1992): A legacy of innovation and service</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a_assignment.html" class="sidebar-item-text sidebar-link">Assignment Part 1</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./b_assignment.html" class="sidebar-item-text sidebar-link">Assignment Part 2</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">workspace</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workspace/simple_pendulum.html" class="sidebar-item-text sidebar-link">Simulating a simple pendulum</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workspace/dc_motor.html" class="sidebar-item-text sidebar-link">DC Motor</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workspace/workspace.html" class="sidebar-item-text sidebar-link">Workspace</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#notebook-objectives" id="toc-notebook-objectives" class="nav-link active" data-scroll-target="#notebook-objectives">Notebook Objectives</a></li>
  <li><a href="#block-diagrams" id="toc-block-diagrams" class="nav-link" data-scroll-target="#block-diagrams">Block Diagrams</a></li>
  <li><a href="#block-diagram-algebra" id="toc-block-diagram-algebra" class="nav-link" data-scroll-target="#block-diagram-algebra">Block Diagram Algebra</a>
  <ul class="collapse">
  <li><a href="#cascaded-blocks" id="toc-cascaded-blocks" class="nav-link" data-scroll-target="#cascaded-blocks">Cascaded Blocks</a></li>
  <li><a href="#parallel" id="toc-parallel" class="nav-link" data-scroll-target="#parallel">Parallel</a></li>
  <li><a href="#feedback-loop" id="toc-feedback-loop" class="nav-link" data-scroll-target="#feedback-loop">Feedback Loop</a></li>
  </ul></li>
  <li><a href="#zero-pole-cancellations" id="toc-zero-pole-cancellations" class="nav-link" data-scroll-target="#zero-pole-cancellations">Zero-Pole Cancellations</a>
  <ul class="collapse">
  <li><a href="#observability-and-controllobality-of-interconnected-systems" id="toc-observability-and-controllobality-of-interconnected-systems" class="nav-link" data-scroll-target="#observability-and-controllobality-of-interconnected-systems">Observability and Controllobality of Interconnected Systems</a></li>
  <li><a href="#stability-of-interconnected-systems" id="toc-stability-of-interconnected-systems" class="nav-link" data-scroll-target="#stability-of-interconnected-systems">Stability of Interconnected Systems</a></li>
  </ul></li>
  <li><a href="#equivalent-block-diagrams" id="toc-equivalent-block-diagrams" class="nav-link" data-scroll-target="#equivalent-block-diagrams">Equivalent block diagrams</a></li>
  <li><a href="#bibo-stability" id="toc-bibo-stability" class="nav-link" data-scroll-target="#bibo-stability">BIBO Stability</a></li>
  <li><a href="#example-car-driving-uphill" id="toc-example-car-driving-uphill" class="nav-link" data-scroll-target="#example-car-driving-uphill">Example: Car driving uphill</a>
  <ul class="collapse">
  <li><a href="#simplercar" id="toc-simplercar" class="nav-link" data-scroll-target="#simplercar">SimplerCar</a></li>
  <li><a href="#simplifying-block-diagrams" id="toc-simplifying-block-diagrams" class="nav-link" data-scroll-target="#simplifying-block-diagrams">Simplifying block diagrams</a>
  <ul class="collapse">
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example 1:</a></li>
  <li><a href="#creating-unity-feedback" id="toc-creating-unity-feedback" class="nav-link" data-scroll-target="#creating-unity-feedback">Creating Unity Feedback</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/andreamunafo/feedback_control/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Block Diagrams</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="notebook-objectives" class="level2">
<h2 class="anchored" data-anchor-id="notebook-objectives">Notebook Objectives</h2>
<p>This notebook will talk about: - Basic components of block diagrams - How to compose block diagrams together - Block diagrams and system properties (e.g., Stability, etc)</p>
<hr>
</section>
<section id="block-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="block-diagrams">Block Diagrams</h2>
<ul>
<li><p>One of the control system engineer’s favorite tools for organizing, communicating, simulating and solving problems</p></li>
<li><p>Standard representation of interconnected systems and subsystems using Transfer Functions</p></li>
<li><p>Makes it easier to identify inputs, outputs and dynamic systems</p></li>
<li><p>Block diagrams show us the interrelationship of systems and how signals flow between them.</p>
<ul>
<li>variables or signals: arrows (<span class="math inline">\(\rightarrow\)</span>)</li>
<li>systems: blocks with a transfer function, and arrows going in (inputs) and out (outputs)</li>
<li>summation node: circle with arrows going in (with the appropriate signs) and an arrow going out</li>
<li>branching points: represents two or more variables are replicas of the variable before the branching point</li>
</ul></li>
<li><p>Always useful during the analysis.</p></li>
</ul>
<p>For example:</p>


<img src="img/19.block-diagram-feedback.png" alt="19.block-diagram-feedback" style="width: 500px;">


</section>
<section id="block-diagram-algebra" class="level2">
<h2 class="anchored" data-anchor-id="block-diagram-algebra">Block Diagram Algebra</h2>
<ul>
<li><p>Block diagrams can be quite complex, and when that happens it is useful to know how to calculate the transfer function between a specific input and a specific output.</p></li>
<li><p>For this, it is better to start with some easy cases: <strong>Cascaded, Parallel and Feedback Loop.</strong></p></li>
<li><p>More complex cases are handled recursively applying these rules. Note that, given that we are restricting the analysis to linear systems, the impact of each input on a specific output is independent of other inputs that can be present (they can all be set to 0).</p></li>
</ul>
<section id="cascaded-blocks" class="level3">
<h3 class="anchored" data-anchor-id="cascaded-blocks">Cascaded Blocks</h3>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/20.block-diagram-serie.png" alt="20.block-diagram-serie" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p>This can be easily calculated using algebric manipulation:</p>
<p><span class="math display">\[Y(s)=G_2(s)U(s)\]</span> <span class="math display">\[U(s)=G_1(s)E(s)\]</span></p>
<p>which means:</p>
<p><span class="math display">\[Y(s)=G_2(s)G_1(s)E(s) \Rightarrow G(s) = G_1(s)G_2(s)\]</span></p>
</section>
<section id="parallel" class="level3">
<h3 class="anchored" data-anchor-id="parallel">Parallel</h3>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/21.block-diagram-parallel.png" alt="21.block-diagram-parallel" style="width: 300px;">
</td>
</tr>

</tbody></table>
<p>This can be easily calculated using algebric manipulation:</p>
<p><span class="math display">\[Y(s)=G_1(s)R(s) + G_2(s)R(s) + G_3(s)R(s) = (G_1(s) + G_2(s) + G_3(s))R(s)\]</span></p>
<p>which means:</p>
<p><span class="math display">\[ G(s) = G_1(s) + G_2(s) + G_3(s)\]</span></p>
<p>Note the presence of: - <em>take off points</em>: allow an unaltered signal to go along multiple paths. - <em>summing junctions</em>: sum or subtract signals</p>
</section>
<section id="feedback-loop" class="level3">
<h3 class="anchored" data-anchor-id="feedback-loop">Feedback Loop</h3>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/22.block-diagram-feedback-simple.png" alt="22.block-diagram-feedback-simple" style="width: 300px;">
</td>
</tr>

</tbody></table>
<p>So, how do we do this one?</p>
<p><span class="math display">\[Y(s)=G_1(s)*E(s)\]</span> <span class="math display">\[E(s)=R(s)-Y_m(s)\]</span> <span class="math display">\[Y_m(s)=G_2(s)Y(s)\]</span></p>
<p>or</p>
<p><span class="math display">\[Y(s)=G_1(s)*(R(s)-Y_m(s)) \rightarrow Y(s)=G_1(s)*(R(s)-G_2(s)Y(s)) \]</span></p>
<p>and finally:</p>
<p><span class="math display">\[Y(s)+G_1(s)G_2(s)Y(s) = G_1(s)*R(s) \]</span></p>
<p><span class="math display">\[ G(s) = \frac{G_1(s)}{1 + G_1(s)G_2(s)} \]</span></p>
</section>
</section>
<section id="zero-pole-cancellations" class="level2">
<h2 class="anchored" data-anchor-id="zero-pole-cancellations">Zero-Pole Cancellations</h2>
<ul>
<li><p>When we compose systems together we expect the order of the system being equal to the sum of the order of each individual system.</p></li>
<li><p>However, when we compose systems together and calculate the transfer function it might happen that the resulting function has less poles.</p>
<ul>
<li>In this case, we have cancellations that correspond to “hidden” parts of the system.</li>
</ul></li>
</ul>
<p>Let’s consider an example:</p>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/23.example-2.png" alt="23.example-1" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p>where</p>
<p><span class="math display">\[\begin{equation}
G_1(s)=\frac{s+1}{s+2}\;\; \text{and}\;\; G_2(s)=\frac{1}{s}
\end{equation}\]</span></p>
<p>We reduce the feedback loop first:</p>
<p><span class="math display">\[G_3(s)=\frac{1/s}{1+1/s} = \frac{1/s}{\frac{s+1}{s}} = \frac{1}{s+1}\]</span></p>
<p>Then the serie: <span class="math display">\[G(s) = \frac{s+1}{s+2} \frac{1}{s+1} = \frac{1}{s+2} \]</span></p>
<p>This connection between two systems determined an “hidden” part, which is not visible in the input/output relationship and the system behaves like a first-order one.</p>
<section id="observability-and-controllobality-of-interconnected-systems" class="level3">
<h3 class="anchored" data-anchor-id="observability-and-controllobality-of-interconnected-systems">Observability and Controllobality of Interconnected Systems</h3>
<ul>
<li><p>Controllability measures the ability of a particular actuator configuration to control all the states of the system;</p></li>
<li><p>Observability measures the ability of the particular sensor configuration to supply all the information necessary to estimate all the states of the system.</p></li>
</ul>
<section id="cascaded-blocks-1" class="level4">
<h4 class="anchored" data-anchor-id="cascaded-blocks-1">Cascaded Blocks</h4>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/20.block-diagram-serie.png" alt="20.block-diagram-serie" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p><span class="math display">\[G(s) = G_1(s)G_2(s) = \frac{N_1(s)}{D_1(s)}\frac{N_2(s)}{D_2(s)}\]</span></p>
<ul>
<li><p>If <span class="math inline">\(N_1(s)\)</span> and <span class="math inline">\(D_2(s)\)</span> have roots in common, then <span class="math inline">\(G(s)\)</span> is not controllable (zero-pole cancellation)</p></li>
<li><p>If <span class="math inline">\(N_2(s)\)</span> and <span class="math inline">\(D_1(s)\)</span> have roots in common, then <span class="math inline">\(G(s)\)</span> is not observable (pole-zero cancellation)</p></li>
</ul>
</section>
<section id="parallel-blocks" class="level4">
<h4 class="anchored" data-anchor-id="parallel-blocks">Parallel Blocks</h4>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/24.block-diagram-parallel-two.png" alt="24.block-diagram-parallel-two" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p><span class="math display">\[G(s) = G_1(s) + G_2(s) = \frac{N_1(s)}{D_1(s)} + \frac{N_2(s)}{D_2(s)} = \frac{N_1(s)D_2(s) + N_2(s)D_1(s)}{D_1(s)D_2(s)}\]</span></p>
<ul>
<li>Cancellations can happen only when <span class="math inline">\(D_1(s)\)</span> and <span class="math inline">\(D_2(s)\)</span> have common roots (you can bring them out together in the numerator and then cancel them out with those in the denumerator). When this happens, we have a <strong>non-observable and non-controllable</strong> part of the system.</li>
</ul>
</section>
<section id="feedback-loop-1" class="level4">
<h4 class="anchored" data-anchor-id="feedback-loop-1">Feedback Loop</h4>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/22.block-diagram-feedback-simple.png" alt="22.block-diagram-feedback-simple" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p><span class="math display">\[G(s) = \frac{G_1(s)}{1 + G_1(s)G_2(s)} =\frac{\frac{N_1(s)}{D_1(s)}}{1 + \frac{N_1(s)}{D_1(s)}\frac{N_2(s)}{D_2(s)}} = \frac{N_1(s)D_2(s)}{D_1(s)D_2(s) + N_1(s)N_2(s)}\]</span></p>
<ul>
<li>We have the equivalent of a serie interconnection: <span class="math inline">\(G_1(s)G_2(s)\)</span>, same rules apply</li>
<li>Cancellations occur when <span class="math inline">\(N_1(s)\)</span> and <span class="math inline">\(D_2(s)\)</span> have common factors (you can bring them out together in the numerator and then cancel them out with those in the denumerator):
<ul>
<li>When zero of <span class="math inline">\(G_1(s)\)</span> cancels a pole of <span class="math inline">\(G_2(s)\)</span> then we have a <strong>non-observable and non-controllable</strong> part of the system.</li>
<li>When pole of <span class="math inline">\(G_1(s)\)</span> cancels a zero of <span class="math inline">\(G_2(s)\)</span> then we still have a <strong>fully observable and fully controllable</strong> system. This is because the denominator of <span class="math inline">\(G(s)\)</span> does not lose its degree.</li>
</ul></li>
</ul>
<p>Example:</p>
<ul>
<li>zero of <span class="math inline">\(G_1(s)\)</span> cancels a pole of <span class="math inline">\(G_2(s)\)</span> <span class="math display">\[G_1(s)=\frac{s+1}{s+2},\;\; G_2(s)=\frac{s+3}{s+1}\]</span></li>
</ul>
<p><span class="math display">\[\Rightarrow G(s)= \frac{\frac{s+1}{s+2}}{1+\frac{s+3}{s+2}} = \frac{s+3}{1+(s+3)}\]</span></p>
<ul>
<li>pole of <span class="math inline">\(G_1(s)\)</span> cancels a zero of <span class="math inline">\(G_2(s)\)</span> <span class="math display">\[G_1(s)=\frac{s+1}{s+2},\;\; G_2(s)=\frac{s+2}{s+3}\]</span></li>
</ul>
<p><span class="math display">\[\Rightarrow G(s)= \frac{\frac{s+1}{s+2}}{1+\frac{s+1}{s+3}} = \frac{\frac{(s+1)(s+3)}{s+2}}{(s+3)+(s+1)} = \frac{(s+1)(s+3)}{(s+2)((s+3)+(s+1))}\]</span></p>
</section>
</section>
<section id="stability-of-interconnected-systems" class="level3">
<h3 class="anchored" data-anchor-id="stability-of-interconnected-systems">Stability of Interconnected Systems</h3>
<p>Let’s now analyse the stability of a system which is obtained through a composition of subsystems.</p>
<p>Question: - Is the asymptotic stability of each indidual subsystem necessary/sufficient to guarantee the stability of the entire system?</p>
<p>Assumption: - Each subsystem are represented by rational functions with numerator and denominator prime between them.</p>
<section id="cascaded-blocks-2" class="level4">
<h4 class="anchored" data-anchor-id="cascaded-blocks-2">Cascaded Blocks</h4>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/20.block-diagram-serie.png" alt="20.block-diagram-serie" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p><span class="math display">\[G(s) = G_1(s)G_2(s) = \frac{N_1(s)}{D_1(s)}\frac{N_2(s)}{D_2(s)}\]</span></p>
<p><strong>No zero-pole cancellations</strong> - The denominator of <span class="math inline">\(G(s)\)</span> is the product of each denominator, and the poles of <span class="math inline">\(G(s)\)</span> are the union of the poles of each subsystem. - If and only if, the poles of <span class="math inline">\(G_1(s)\)</span> and <span class="math inline">\(G_2(s)\)</span> have Re <span class="math inline">\(&lt;0\)</span>, then <span class="math inline">\(G(s)\)</span> is asymptotically stable.</p>
<p><strong>Zero-pole/pole-zero cancellations</strong> - In this case, the overall system has an hidden part corresponding to the zero-pole or pole-zero cancellation. In this case, <em>if the cancellation is of a pole with Re <span class="math inline">\(\ge0\)</span> then the hidden part is not stable and the entire system is not stable</em>. - We call these types of cancellations, <strong>critical</strong>. - Note that this is not visible directly from the transfer function!</p>
</section>
<section id="parallel-blocks-1" class="level4">
<h4 class="anchored" data-anchor-id="parallel-blocks-1">Parallel Blocks</h4>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/24.block-diagram-parallel-two.png" alt="24.block-diagram-parallel-two" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p><span class="math display">\[G(s) = G_1(s) + G_2(s) = \frac{N_1(s)}{D_1(s)} + \frac{N_2(s)}{D_2(s)} = \frac{N_1(s)D_2(s) + N_2(s)D_1(s)}{D_1(s)D_2(s)}\]</span></p>
<p>The analysis is similar to the previous case (serie).</p>
<p>If there are no cancellations, the poles of <span class="math inline">\(G(s)\)</span> are the product of the poles of <span class="math inline">\(G_1(s)\)</span> and of <span class="math inline">\(G_2(s)\)</span>. - <span class="math inline">\(G(s)\)</span> is asymptotically stable, if and only if, the poles of <span class="math inline">\(G_1(s)\)</span> and <span class="math inline">\(G_2(s)\)</span> have Re <span class="math inline">\(&lt;0\)</span>.</p>
<p>If there are cancellations, then the overall system has an hidden part corresponding to the zero-pole or pole-zero cancellation. If the cancellation is of a pole with Re <span class="math inline">\(&gt;=0\)</span> then the hidden part is not stable and the entire system is not stable.</p>
<p>Again, this is not visible analysing the final T.F.</p>
</section>
<section id="feedback-loop-2" class="level4">
<h4 class="anchored" data-anchor-id="feedback-loop-2">Feedback Loop</h4>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/22.block-diagram-feedback-simple.png" alt="22.block-diagram-feedback-simple" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p><span class="math display">\[G(s) = \frac{G_1(s)}{1 + G_1(s)G_2(s)} =\frac{\frac{N_1(s)}{D_1(s)}}{1 + \frac{N_1(s)}{D_1(s)}\frac{N_2(s)}{D_2(s)}} = \frac{N_1(s)D_2(s)}{D_1(s)D_2(s) + N_1(s)N_2(s)}\]</span></p>
<ul>
<li>In this case, the poles of the entire system are not only dependednt on the poles of the two subsytems (the numerators are also playing a role).</li>
</ul>
<p>If we do not have cancellations, then the poles of the systems are the roots of the equation:</p>
<p><span class="math display">\[D_1(s)D_2(s) + N_1(s)N_2(s) = 0\]</span></p>
<p><em>this is called characteristic equation of the feedback system.</em></p>
<p>We can also write the equation above as:</p>
<p><span class="math display">\[ 1 + \frac{N_1(s)D_2(s)}{D_1(s)D_2(s)} = 0\]</span></p>
<p>The feedback system is asymptotically stable if and only if the roots of the previous equation are with Re <span class="math inline">\(&lt;0\)</span>, but this does not depend on the stability property of the individual systems.</p>
<p><strong>Critical cancellations</strong></p>
<ul>
<li>Note that when we calculate <span class="math inline">\(\frac{N_1(s)D_2(s)}{D_1(s)D_2(s)}\)</span> we can have <em>critical cancellations</em> and these would correspond to hidden parts of the system (Note that we are assuming to use <span class="math inline">\(y\)</span> or <span class="math inline">\(y_m\)</span> as output variables of the system).</li>
<li>As before, if these critical cancellations are of poles with Re <span class="math inline">\(\ge0\)</span>, these hidden parts are not asymptotically stable and neither is the full system.</li>
<li>This is not visible from the analysis of the T.F.</li>
<li>We have to verify if there are <em>critical</em> cancellations before we analyse the stability of the feedback system.</li>
</ul>
<p>Since the poles of the feedback system are, in general, different from the poles of the individual subsystems, we can use this connection to effectively modify the dynamics of the system, placing the poles where we need them. For example, it is possible to stabilise a non-stable system, or obtain desired performance.</p>
<p>Note that the opposite is also true: we can have a non-stable system even if we the individual subsystems are stable.</p>
</section>
</section>
</section>
<section id="equivalent-block-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="equivalent-block-diagrams">Equivalent block diagrams</h2>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/23.table-block-diagrams.png" alt="23.table-block-diagrams" style="width: 650px;">
</td>
</tr>

</tbody></table>
</section>
<section id="bibo-stability" class="level2">
<h2 class="anchored" data-anchor-id="bibo-stability">BIBO Stability</h2>
<ul>
<li>A system is BIBO stable (Bounded Input, Bounded Output) if for each limited input, there is a limited output</li>
<li>For linear systems: BIBO stability if and only if poles of the transfer functions have Re <span class="math inline">\(&lt;0\)</span></li>
<li><strong>Caution! The poles of the T.F. are only those that are controllable and observable!</strong></li>
<li>BIBO stability only depends on the forced response of the system.</li>
</ul>
</section>
<section id="example-car-driving-uphill" class="level1">
<h1>Example: Car driving uphill</h1>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/9.car-uphill.png" alt="9.car-uphill.png" style="width: 350px;">
</td>
</tr>

</tbody></table>
<p>We can model a car moving uphill using a linear model (small angle approximation) as:</p>
<p><span class="math display">\[\begin{equation}
A=\frac{df}{dx}=
\begin{bmatrix}
0 &amp; 1\\
0 &amp; -\frac{\beta}{m}
\end{bmatrix}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
B=\frac{df}{du}=
\begin{bmatrix}
0 &amp; 0\\
\frac{\gamma}{m} &amp; -g
\end{bmatrix}
\end{equation}\]</span></p>
<p>and</p>
<p><span class="math display">\[\dot{\mathbf{x}}=A\mathbf{x}+B\mathbf{u}\]</span> <span class="math display">\[y=[0 \; 1]\mathbf{x}\]</span></p>
<p>Note that: - If <span class="math inline">\(\theta = 0\)</span> and <span class="math inline">\(u=0\)</span> (no slope, and no input) - then the equilibrium is <span class="math inline">\(\forall x_1\)</span>, <span class="math inline">\(x_2=0\)</span> (the position does not matter, speed is 0). - this system has two inputs: the pedal and gravity</p>
<p>We can calculate the Matrix Transfer Function as:</p>
<p><span class="math display">\[G(s)=C(sI-A)^{-1}B\]</span></p>
<p><span class="math display">\[\begin{equation}
(sI-A) =
\begin{bmatrix}
s &amp; -1\\
0 &amp; s+\frac{\beta}{m}
\end{bmatrix}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
(sI-A)^{-1} = \frac{1}{s(s+ \frac{\beta}{m})}
\begin{bmatrix}
s+ \frac{\beta}{m} &amp; 1\\
0 &amp; s
\end{bmatrix}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
G(s) = \frac{1}{s(s+ \frac{\beta}{m})}
\begin{bmatrix}
s \frac{\gamma}{m} &amp; -sg
\end{bmatrix} =
\begin{bmatrix}
\frac{\frac{\gamma}{m}}{s+\frac{\beta}{m}} &amp; \frac{-g}{s+\frac{\beta}{m}}
\end{bmatrix}
\end{equation}\]</span></p>
<p>If we want to know the T.F. from the pedal to the velocity:</p>
<p><span class="math display">\[G_{1,1}(s)=\frac{\frac{\gamma}{m}}{s+\frac{\beta}{m}}\]</span></p>
<p>What happens when we apply a step onto the pedal?</p>
<p>Let’s study the transfer function and include the input:</p>
<p><span class="math display">\[Y(s) = G(s)U(s)=\frac{\frac{\gamma}{m}}{s+\frac{\beta}{m}} \frac{1}{s} = \frac{\alpha_1}{s+\frac{\beta}{m}} + \frac{\alpha_2}{s}\]</span></p>
<p>where <span class="math display">\[\alpha_1=-\frac{\gamma}{\beta}, \; \alpha_2=\frac{\gamma}{\beta}\]</span></p>
<p>and the inverse transform is:</p>
<p><span class="math display">\[ y(t) = \alpha_1 e^{-\frac{\beta}{m}t} + \alpha_2 1(t)\]</span></p>
<p>We can implement this in Python:</p>
<p>Let’s define the step function first</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> feedback_control.intro_to_control_theory <span class="im">import</span> step</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># def step(t, step_time=0):</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     """Heaviside step function"""</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     return 1 * (t &gt;= step_time)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we can plot the response of the system <span class="math inline">\(y(t)\)</span> to the step input:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We decide the parameters of the car</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>gamma <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We set the simulation parameters</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">15</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can calculate the output of the system</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>alpha_1 <span class="op">=</span> <span class="op">-</span>gamma<span class="op">/</span>beta</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>alpha_2 <span class="op">=</span> gamma<span class="op">/</span>beta</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> alpha_1<span class="op">*</span>np.exp(<span class="op">-</span>beta<span class="op">/</span>m<span class="op">*</span>t) <span class="op">+</span> alpha_2<span class="op">*</span>step(t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we can plot it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plt.plot(t, y, linewidth<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time (s)'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'speed (m/s)'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>plt.grid()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="04_Block_Diagrams_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Essentially we predict that the car will increase its speed to try and match our step input.</p>
<p>But what does the actual car do?</p>
<p>We implemented a car already in notebook <code>02_Intro_to_control_theory</code>, but here it is again for convenience:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Car:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    _g <span class="op">=</span> <span class="fl">9.8</span> <span class="co"># Gravity</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x0, params):</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._x_1 <span class="op">=</span> x0[<span class="dv">0</span>] <span class="co"># position (along the road)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._x_2 <span class="op">=</span> x0[<span class="dv">1</span>] <span class="co"># velocity (along the road)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._m, <span class="va">self</span>._alpha, <span class="va">self</span>._beta, <span class="va">self</span>._gamma <span class="op">=</span> params</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> step(<span class="va">self</span>, dt, u, theta):</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.theta <span class="op">=</span> theta</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._x_1 <span class="op">=</span> <span class="va">self</span>._x_1 <span class="op">+</span> dt<span class="op">*</span><span class="va">self</span>._x_2</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._x_2 <span class="op">=</span> <span class="va">self</span>._x_2 <span class="op">+</span> dt<span class="op">*</span>(<span class="op">-</span><span class="va">self</span>._alpha<span class="op">/</span><span class="va">self</span>._m<span class="op">*</span><span class="bu">abs</span>(<span class="va">self</span>._x_2)<span class="op">*</span><span class="va">self</span>._x_2 <span class="op">-</span> <span class="op">\</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="va">self</span>._beta<span class="op">/</span><span class="va">self</span>._m<span class="op">*</span><span class="va">self</span>._x_2 <span class="op">+</span> <span class="va">self</span>._gamma<span class="op">/</span><span class="va">self</span>._m<span class="op">*</span>u <span class="op">-</span> <span class="op">\</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                                    Car._g<span class="op">*</span>np.sin(theta))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> speedometer(<span class="va">self</span>):        </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> <span class="va">self</span>._x_2</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (v,)  </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Utility function to simplify plotting</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sensor_i(<span class="va">self</span>):</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Rotation matrix to get back to the main frame.</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        R <span class="op">=</span> np.array(((np.cos(theta), <span class="op">-</span>np.sin(theta)), (np.sin(theta), np.cos(theta))))</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        x_i, y_i <span class="op">=</span> R.dot(np.array([[<span class="va">self</span>._x_1],[<span class="dv">0</span>]]))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> <span class="va">self</span>._x_2</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (x_i, y_i, v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now run it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We define the parameters of the car</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>gamma <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> (m, alpha, beta, gamma)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define its initial conditions</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>x_0 <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="co"># position and speed</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> np.radians(<span class="dv">0</span>) <span class="co"># no slope</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the input: step function</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> <span class="dv">1</span> <span class="co"># input (e.g. 0 or 1)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the car</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>car <span class="op">=</span> Car(x_0, params)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># run it!</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>t0, tf, dt <span class="op">=</span> <span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#rotation to get back to the inertial frame..</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>c, s <span class="op">=</span> np.cos(theta), np.sin(theta)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> np.array(((c, <span class="op">-</span>s), (s, c)))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>position <span class="op">=</span> []</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>velocity <span class="op">=</span> []</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> []</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> np.arange(t0, tf, dt):</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    car.step(dt, u, theta)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> car.speedometer() <span class="co"># this is in the along road frame</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    velocity.append(v)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    time.append(t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(t0, tf, dt), velocity, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time (s)'</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'speed (m/s)'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>plt.grid()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="04_Block_Diagrams_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Hmm, the speed has a step response but it does not go to 1…</p>
<p>The reason is that the actual car does behave differently from our linear model. Let’s try another car:</p>
<hr>
<p><a href="https://github.com/andreamunafo/feedback_control/blob/main/feedback_control/block_diagrams.py#L11" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="simplercar" class="level3">
<h3 class="anchored" data-anchor-id="simplercar">SimplerCar</h3>
<blockquote class="blockquote">
<pre><code> SimplerCar (x0, params)</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<p>And now we can run it again,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We define the parameters of the car</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>gamma <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> (m, alpha, beta, gamma)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define its initial conditions</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>x_0 <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="co"># position and speed</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> np.radians(<span class="dv">0</span>) <span class="co"># no slope</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the input: step function</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> <span class="dv">1</span> <span class="co"># input (e.g. 0 or 1)</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the car</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>car <span class="op">=</span> SimplerCar(x_0, params)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># run it!</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>t0, tf, dt <span class="op">=</span> <span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#rotation to get back to the inertial frame..</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>c, s <span class="op">=</span> np.cos(theta), np.sin(theta)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> np.array(((c, <span class="op">-</span>s), (s, c)))</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>position <span class="op">=</span> []</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>velocity <span class="op">=</span> []</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> []</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> np.arange(t0, tf, dt):</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    car.step(dt, u, theta)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> car.speedometer() <span class="co"># this is in the along road frame</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    velocity.append(v)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    time.append(t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plt.plot(time, velocity, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'time (s)'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'speed (m/s)'</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.grid()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="04_Block_Diagrams_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Alright! Our linear model represents this second car better.</p>
<hr>
</section>
<section id="simplifying-block-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="simplifying-block-diagrams">Simplifying block diagrams</h2>
<p>Let’s now apply the block diagram algebra to some examples:</p>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example 1:</h3>
<p>Let’s suppose that we have a classic negative feedback:</p>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/24.block-diagram-ex-1-1.png" alt="24.block-diagram-ex-1-1" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p><span class="math inline">\(B\)</span> and <span class="math inline">\(C\)</span> are in series and we can combine them into a single block:</p>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/24.block-diagram-ex-1-3.png" alt="24.block-diagram-ex-1-1" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p>We can now reduce the feedback loop:</p>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/24.block-diagram-ex-1-4.png" alt="24.block-diagram-ex-1-1" style="width: 500px;">
</td>
</tr>

</tbody></table>
<p>And lastly we can combine the two blocks in series:</p>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<img src="img/24.block-diagram-ex-1-51.png" alt="24.block-diagram-ex-1-1" style="width: 500px;">
</td>
</tr>

</tbody></table>
</section>
<section id="creating-unity-feedback" class="level3">
<h3 class="anchored" data-anchor-id="creating-unity-feedback">Creating Unity Feedback</h3>
<ul>
<li><p>Sometimes when we manipulate block diagrams we do not want to remove blocks to simplify the diagram, but we would like to restructure the diagram to have it in a specific form.</p></li>
<li><p>For example we would like to make the following equivalent:</p>

<table style="margin: 0 auto" rules="none">
<tbody><tr>
<td>
<p><img src="img/24.non-unity-feedback.png" alt="24.non-unity-feedback" style="width: 500px;"></p>
</td>
<td>
<p><img src="img/24.unity-feedback.png" alt="24.unity-feedback" style="width: 500px;"></p>
</td>
</tr>

</tbody></table></li>
<li><p>We need to determine an <span class="math inline">\(R(s)\)</span> value that makes the two systems equivalent.</p></li>
<li><p>We need to write the transfer function for each system, set the two equations equal to each other, and then solving for <span class="math inline">\(R(s)\)</span>.</p></li>
</ul>
<p><span class="math display">\[
\frac{G(s)}{1+G(s)H(s)} = \frac{R(s)}{1+R(s)}  
\]</span></p>
<p><span class="math display">\[ \Downarrow \]</span></p>
<p><span class="math display">\[
\frac{G(s) (1+R(s))}{1+G(s)H(s)} = R(s)
\]</span></p>
<p><span class="math display">\[ \Downarrow \]</span></p>
<p><span class="math display">\[
\frac{G(s)}{1+G(s)H(s)} = R(s) \bigg( 1- \frac{G(s)}{1+G(s)H(s)} \bigg)
\]</span></p>
<p><span class="math display">\[ \Downarrow \]</span></p>
<p><span class="math display">\[
R(s) = \frac{G(s)}{1+G(s)H(s)-G(s)}
\]</span></p>
<p>Note that we would not be able to easily use this method to go from a unity feedback system to a non-unity feedback system (there will be two unknown variables).</p>
<hr>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>